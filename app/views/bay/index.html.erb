<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
  <head>
	  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	  <title>Warehouse Layout</title>
	  <style>
		#content 	      { float: left;  height: 510px; width: 100%; background: white; }
        #area 	          { float: left;  height: 400px; width: 40%; background: white; border: 1px solid #000; }             
		.col              { float: left;  height: 20px; width: 80px;}
        .bay              { float: left;  height: 20px; width: 80px; border: 1px solid #000; background: -webkit-gradient(linear, left top, right top, from(#888888), to(#F8F8F8));}
		.bay_Empty        { float: left;  height: 20px; width: 80px; border: 1px solid #999; background: white;}
		.bay_draggedhelper{ float: left;  height: 20px; width: 80px; border: 1px solid #000; background: -webkit-gradient(linear, left top, right top, from(#888888), to(#F8F8F8));}
		.aisle_divider    { float: left;  height: 2px; width: 327px; border: 2px solid #999; background: black}
		.aisle_drivepath  { float: left;  height: 5px; width: 324px; border: 0px solid #000; background: white}
        #positionspace    { float: left;  height: 400px; width: 55%; background: white; border: 1px solid #000;; }        

body {
	padding: 40px;
	overflow-x: hidden; /* For Opera */
	-webkit-box-shadow:
		inset #19d4ff 0 0 0 5px,
		inset #18cdf7 0 0 0 1px,
		inset #53dfff 0 0 0 10px,
		inset #50d8f7 0 0 0 11px;

}

     </style>
     
	  <%= javascript_include_tag :application %>
	  <%= yield :head %>

      <script type="text/javascript">
      
      //global variable and call initialize function.
      index_html_map = {}	    
	  $( init );


	//To swap the position of two items
	function init() { 
 				 indexHTML.setDragnDrop();
 				 indexHTML.setClickitem();
 			}  



var indexHTML = {

	setDragnDrop: function setDragnDrop() { 

		  $('.bay').draggable(
		     {containment: '#content',
		      //cursor: 'move',
		      //snap: '#area',
		      revert: true, 
		      helper: helpermethod,


		      start: function(event, ui) {
						 index_html_map.dragged="yes";  								 
					     index_html_map.bay = $(this).attr('id');
					     index_html_map.title = $(this).attr('title');
					     index_html_map.content = $(this).attr('class');

			 			 //alert('After drag' + ' ' +  $(this).attr('class'));	

		 	   }
		  });

		function helpermethod( event ) {

			  //image = '<%= image_tag("pallet.jpg", alt: "", :width => 80, :height => 80) %>' 	
	  		   newdiv = '<div id="bay_draggedhelper" class="bay_draggedhelper">' +  ($(this).attr('title')).substring(14) + '</div>'
	  		   return newdiv;
		}



		  $('.bay_Empty, .bay').droppable( {
		  	  drop: handleDropEvent

		    } ); 



		function handleDropEvent( event, ui ) {

			  if(index_html_map.dragged=="no")
			  {
			  	return;

			  }	
			  else
			  {
			  	index_html_map.dragged="no";
			  }

			  oldTitle = $(this).attr('title');
			  oldid = $(this).attr('id');

			  $(this).removeClass('ui-draggable ui-droppable')
			  oldClass = $(this).attr('class');
			  //alert(oldClass + " "+ oldid);	


			  //this code is written because ui-droppable is always appeneded after the JQuery			  
			  $('#bay_draggedhelper').html(oldTitle);
			  $('#bay_draggedhelper').attr(oldClass);


			  $(this).attr('title', index_html_map.title);
			  $(this).attr('class', index_html_map.content);
			  $(this).removeClass('ui-draggable ui-droppable')


			  bay = index_html_map.bay;


			  $("#"+bay).attr('title', oldTitle);
			  $("#"+bay).attr('class',  oldClass);


			  $.post("/bay",
				{
					"bay[event]": "update_class",
					"bay[dragbay_id]": bay,
					"bay[dragbay_class]": oldClass,
					"bay[dragbay_title]" : oldTitle.substring(14),
					"bay[dropbay_id]":     $(this).attr('id'),
					"bay[dropbay_class]":  $(this).attr('class'),
					"bay[dropbay_title]" :  ($(this).attr('title')).substring(14)

				},
				function(data,status)
				{

				});


			  indexHTML.setDragnDrop();
			  indexHTML.setClickitem();


			} 
	},

  	 //JQuery 		

	  //$(document).ready(function(){  
	  setClickitem: function setClickitem() {	

		    $('.bay').click(function(){   

		    	if (($(this).attr('class')).substring(0, 9)!= "bay_Empty") {

				  $("#positionspace").load("/position/"+this.id); 

				 }

			});



		      $('.bay, .bay_Empty').dblclick(function(){
	    		 if($('#'+ $(this).attr('id') + '_text').length>0) { 

	  				labelID = $(this).attr('id') + '_label';	
		     		textID  = $(this).attr('id') + '_text';

			 	 	newlabel = $(document.createElement("label"))
			     	.attr("id", labelID);
			     	 $(this).append(newlabel);     	

				    $.post("/bay",
				    {
				      "bay[event]": "update_position",		
				      "bay[bay_id]": $(this).attr('id'),
				      "bay[customer_bay_id]": $('#'+ textID).attr('value')
				    },
				    function(data,status){
				    	  //alert(status);	
						  if (status=="success") {

				      			$("#positionspace").load("/position/"+data);
							}	
						  else
						  	{
						  		alert("Internal server Error");
						  	}	
				    });

			    	 $('#'+labelID).html( "Bay " + $('#'+ textID).attr('value'));
			 	 	 $('#'+ textID).remove();
			 	 }

			 	else{

				  	labelID = $(this).attr('id') + '_label';	
				 	textID  = $(this).attr('id') + '_text';

				     newTextBox = $(document.createElement("input"))
				    .attr("type", "text")
				    .attr("id", textID)
				    .attr("name", $(this).attr('id'))
				    .attr("style", "width: 80px")
				    .attr("style" , "border-style: solid")
				    .attr("style" , "border-color: orange")
				    .attr("value", ($("#"+labelID).html()).substring(4))
				     $(this).append(newTextBox);
				     $("#" + textID).focus();
				  	 $("#" + labelID).remove();
				}
			}); 
	}
	//);	


} //End of indexHTML

</script>

  </head>
<body>

<div id="main" style="width: 100%; height: 600px;" >
	<div id="navingation" style="float: left; left-margin: 10px; width: 100%; height: 80px;  " >
		<%= link_to image_tag("compass.jpg", alt: "direction", :width => "80px", :height => "80px"), '' %>
		<br>
	</div>
<div id="content" class="content">

   <div id="area" class="area"> 
   	<table border="0" id ="bayTable" style="border-collapse:collapse;">
   	<% @aislehash.each do |key, value| %>
		<tr>
    	<% value.each do |key1, value1| %>
  
 				<%if key1== :aisleseparation %>
					<td>

 					<%if value1== "drivepath" %>
 						<div  class="aisle_drivepath"> </div>   	       
	   	       			 <hr style="width: 320px; float: left" color="blue">   	       
	   	      		    <div class="aisle_drivepath"> </div> 
	   	      		 <% else %>
	   	      		   	<div  class="aisle_divider"> </div>
          			<% end %>
          			</td></tr><tr>
          		<% else %>
          			<td class="col">
	 	 		     <div id="<%= key1 %>" class="<%= value1[:type] %>" title=" Product Type: <%= value1[:item] %>" >	   	    	  
		   	    	 <label id="<%= key1%>_label"> Bay <%= value1[:customerid] %> </label> 	   	    	
		   	    </div>
		   	    </td>
	   		<% end %>
    
         <%end%>
    </tr>
         
  <%end%>
   
 </table>

  
   </div>
   
   <div id="positionspace" class= "positionspace"> </div>
   
</div>
 
</div>

  <%= yield %>
  </body>
</html>