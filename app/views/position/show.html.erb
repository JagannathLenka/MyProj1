<!DOCTYPE html PUBLIC "-//W3C//osDTD  HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
  <head>
	  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	  <title>bay.html</title>
	  <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />
	  <style>
	  	 #position 			{ float: left; background: white; border-width:1px;}
	  	.pos 				{ float: left; height: 15px; width: 60px;  border: 1px solid #000; border-right:5px solid black;background-color: #eec917;"}
	    .pos_Empty 			{ float: left; height: 15px; width: 60px;  border: 1px solid #000; border-right:5px solid black;background-color: white;}
	    .pos_draggedhelper  { float: left; height: 15px; width: 60px;  border: 1px solid #000; border-right:5px solid black;background-color: #eec917;"} 
	    .orange				{ float: left; height: 15px; width: 60px;  border: 1px solid #000; border-right:5px solid black;background-color: orange;}
	    .green				{ float: left; height: 15px; width: 60px;  border: 1px solid #000; border-right:5px solid black;background-color: green;}
	    .red				{ float: left; height: 15px; width: 60px;  border: 1px solid #000; border-right:5px solid black;background-color: red;}
	    .pos_divider 		{ float: left; height: 2px;  width: 520px; border: 2px solid #999; background: black}  
		.bay                { float: center;  margin:auto; height: 20px; width: 80px; border: 1px solid #000; background: -webkit-gradient(linear, left top, right top, from(#888888), to(#F8F8F8));}


		

		</style>
	  <%= javascript_include_tag :application %>
	  <%= yield :head %>
<script type="text/javascript">	

//global variable
    bay_html_map = {}	          
	$( init );
 
 $(document).ready(function(){  

		    $('#zoom').click(function(){
		    $('#location2').load("/position/"+ <%= @bay_id %>); 
		    $('#location2').animate({ 'zoom': 1.4 }, 800);
		    $('#location2').dialog({
    	  	height: 500,
      		width: 1000,
      		modal: true
    });
					
	});	    
});

  
 
//

//To swap the position of two items
function init() { 
 
 	bayHTML.setDragnDrop()
}

var bayHTML = {
	
setDragnDrop: function setDragnDrop() { 
 
	  $('.pos').draggable(
	     {
	     //containment: '#position',
	      //cursor: 'move',
	      //snap: '#position',
	      revert: true, 
	      helper: helpermethod,
	      
	      start: function(event, ui) {
					 var offset = $(this).offset(); 
					 
					 bay_html_map.pos= $(this).attr('id');
					 bay_html_map.title= $(this).attr('title');
					 bay_html_map.content= $(this).attr('class') ;
					 
	 	   }
	  });

	function helpermethod( event ) {
  	
		  //image = '<%= image_tag("pallet.jpg", alt: "", :width => 60, :height => 60) %>' 	
  		   newdiv = '<div id ="pos_draggedhelper" class="pos_draggedhelper">' +  $(this).attr('title') + '</div>'
  		   return newdiv;
	}
	
	
	  $('.pos_Empty').droppable( {
	  	  drop: handleDropEvent
	  	  
	    } ); 
	  
   
	function handleDropEvent( event, ui ) {

		  ui.draggable.element = $(this); 		  
		  oldTitle = $(this).attr('title');
		  oldClass = $(this).attr('class');
		  $(this).attr('title', bay_html_map.title);
		  $(this).attr('class', bay_html_map.content);

		 $('#pos_draggedhelper').html("");			  
		 $('#pos_draggedhelper').attr('class', 'pos_Empty');	
		  pos = bay_html_map.pos;
		  $("#"+pos).attr('title', oldTitle);
		  $("#"+pos).attr('class', oldClass);
		  ui.draggable.draggable( 'disable' );
		  bayHTML.setDragnDrop();
		  $.post("/position",
		  				{
		  					"position[event]": "update_posclass",
		  					"position[dragpos_id]": pos,
		  					"position[dragpos_class]": oldClass,
		  					"position[dragpos_title]" :oldTitle,
		  					"position[droppos_id]": $(this).attr('id'),
		  					"position[droppos_class]":bay_html_map.content,
		  					"position[droppos_title]" :bay_html_map.title
		  					
		  				},
		  				function(data,status)
		  				{
		  					
          				});
          	
		} 
	} //ends the init function

}

</script>

  </head>
  <body>
 
<div id="position" class="position" style="height: 300px; width: 520px; margin-left: 30px">
   
   <div align="center" class="bay"> Bay <%= @customer_bay_id %> </div>
   
   <div style="float: left" id="location"> 
    <table border="0" style="border-collapse:collapse">
   	
   	<% @levelhash.each do |key,value| %>
   	
   	<tr> 	  
     
     <% value.each do |key1 , value1| %>
	
     	<% if key1 == :leveltype %>
   	   	  <td>
   	   	  	<% if value1 == "stretch" %>
   	   	  	  <div class="orange">Level <%= key %></div>
   	   	  	  <% end %>
   	   	  	<%  if value1 == "normal" %>
   	   	  	   <div class="green">Level <%= key%> </div>
   	   	  	   <% end %>
   	   	  	 <% if value1 == "bend" %>
   	   	  	     <div class="red">Level <%= key %></div>
   	   	  	 <% end %>
   	   	  </td>
   	   	
   	   <% else %>
   
    	
    	<td>
			<div id="<%= key1 %>" class="<%= value1[:postype] %>" title="<%= value1[:item] %>"> 
				<label id="<%= key1%>_label"> <%= key1 %></label>
		    </div>
			 
		</td>
	<% end %>
	
 <% end %>
 
</tr>
 <tr>
 	<td style="height: 2px; border: 2px solid #000;" colspan="9"></td></tr>
 
<% end %>
</table>
</div>
<div style="float: left; border: 1px solid #000;"><%= image_tag("zoom.jpg", alt: "", :width => 40, :height => 40, :id => "zoom")%></div>
</div>
<div id="location2"></div>

  <%= yield %>
 </body>

</html>
